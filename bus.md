# bus系统
##管理端
1. SIM卡是什么？有哪些属性？使用场景在哪里？归属于什么机构？

1. 表通用字段
  status, create_time, update_time
  查询时需要过滤掉status=0记录，create_time, update_time 只作为标记字段，不做参与任何业务逻辑。
1. 用户具有 enable 字段
  
1. 公交平台的设备由dm平台同步过来

1. 商户层次
  <公交公司> -> [分公司] -> <线路> -> <车辆>
  设备销售到公交公司，然后由公交公司管理用户绑定设备到线路或车辆。
  设备在线路和车辆下都可以使用还是必须存在车辆下才能使用。

1. 公交公司/分公司，线路，车辆使用单独表，各自具有哪些信息
  总公司
    分公司
      线路
        车辆
   这四种机构对层级关系在单独表中如何体现（使用treeId?）
1. 由于不同类型机构在不同表中，所以机构名对重复限制不能表上限制（多列唯一限制）

1. 总公司与分公司关系
  是否必须存在分公司
  总公司能否直接操作分公司下的线路，车辆以及设备信息

1. 表中记录使用逻辑删除，查询时总过滤掉已删除数据。
  逻辑删除数据只作为记录保留，不考虑删除恢复功能。

1. 机构关键信息是否允许修改，如机构名称，假如允许修改，对于某些表中冗余数据如何处理（如冗余机构表的机构名）


##支付
1. 支付配置
  支付宝/微信都存在服务商用户配置，且服务商配置是不能直接使用的，在为机构配置支付配置时是否需要限制配置类型。
  如：服务商配置不能应用到车辆上，已配置的普通商户对机构下级不能再进行其他配置。

1. 支付仍然保留两中支付轮询方式（前端轮询，后端轮询）。 
  前端轮询问题：
     需要保证前端生成支付ID唯一
     轮询，撤单都需要使用前端生成的支付ID
        避免前端提交支付后没能获取到服务响应，这时前端需要一个它已知的标识来发起查单、撤单操作
     退款使用后端订单号（退款时前端总是已知订单的后端订单号的）
     如何避免前端发起支付后，突然断网的问题？
        后台要保证对一定长时间后未支付的订单自动调用撤单操作。
      
1. 支付jar包提取，支付提取成单独jar包（是否每个支付通道作为单独dubbo服务提供）

1. 支付订单表，不能单独只记录一个机构ID，还可能需要机构类型信息

1. 公交支付过于密集，需要考虑使用缓存减轻压力
  主要在于订单表的插入和查询

  
